-- Active: 1680598127192@@127.0.0.1@3306@homework
USE homework;

CREATE TABLE S(
    SNO CHAR(3),
    SNAME CHAR(20),
    STATUS CHAR(20),
    CITY CHAR(20)
);
CREATE TABLE P(
    PNO CHAR(3),
    PNAME CHAR(20),
    COLOR CHAR(20),
    WEIGHT INT
);
CREATE TABLE J(
    JNO CHAR(3),
    JNAME CHAR(20),
    CITY CHAR(20)
);
CREATE TABLE SPJ(
    SNO CHAR(3),
    PNO CHAR(3),
    JNO CHAR(3),
    QTY INT
);

INSERT INTO S 
(SNO,SNAME,STATUS,CITY)
VALUES
('S1','JINYI','20','TIANJIN'),
('S2','SHENGXI','10','BEIJING'),
('S3','DONGFANGHONG','30','BEIJING'),
('S4','FENTAISHENG','20','TIANJIN'),
('S5','WEIMIMG','30','SHANGHAI');
INSERT INTO P
(PNO,PNAME,COLOR,WEIGHT)
VALUES
('P1','LUOMU','RED',12),
('P2','LUOSHUANG','GRENN',17),
('P3','LUOSIDAO','BLUE',14),
('P4','LUOSIDAO','RED',14),
('P5','TULUN','BLUE',40),
('P6','CHILUN','RED',30);
INSERT INTO J
(JNO,JNAME,CITY)
VALUES
('J1','SANJIAN','BEIJING'),
('J2','YIQI','CHANGCHUN'),
('J3','TANHUANGCHANG','TIANJIN'),
('J4','ZAOCHECHANG','TIANJIN'),
('J5','JICHECHANG','TANGSHANG'),
('J6','WUXIANDIANCHANG','CHANGZHOU'),
('J7','BANDAOTICHANG','NANJING');
INSERT INTO SPJ
(SNO,PNO,JNO,QTY)
VALUES
('S1','P1','J1',200),
('S1','P1','J3',100),
('S1','P1','J4',700),
('S1','P2','J2',100),
('S2','P3','J1',400),
('S2','P3','J2',200),
('S2','P3','J4',500),
('S2','P3','J5',400),
('S2','P5','J1',400),
('S2','P5','J2',100),
('S3','P1','J1',200),
('S3','P3','J1',200),
('S4','P5','J1',100),
('S4','P6','J3',300),
('S4','P6','J4',200),
('S5','P2','J4',100),
('S5','P3','J1',200),
('S5','P6','J2',200),
('S5','P6','J4',500);

SELECT SNO
FROM SPJ
WHERE JNO='J1';

SELECT SNO
FROM SPJ
WHERE JNO='J1' AND PNO = 'P1';

SELECT SNO
FROM SPJ
WHERE JNO='J1'
    AND PNO IN 
    (
        SELECT PNO
        FROM P
        WHERE COLOR='RED'
    );

SELECT JNO 
FROM J 
WHERE NOT EXISTS
(
    SELECT *
    FROM S,P,SPJ
    WHERE SPJ.JNO=J.JNO 
    AND SPJ.SNO=S.SNO 
    AND SPJ.PNO=P.PNO
    AND S.CITY='TIANJIN' 
    AND P.COLOR = 'RED'
);

--不存在这样的工程,供应商s1供给了零件p,而工程j没有选用
SELECT DISTINCT JNO 
FROM SPJ X
WHERE NOT EXISTS
(
    SELECT *
    FROM SPJ Y
    WHERE Y.SNO='S1'
        AND NOT EXISTS
        (
            SELECT *
            FROM SPJ Z
            WHERE  Y.PNO=Z.PNO
                AND Y.JNO=X.JNO
        )
);

SELECT SNAME,CITY
FROM S;

SELECT PNAME,COLOR,WEIGHT
FROM P;

SELECT JNO
FROM SPJ
WHERE SNO='S1';

SELECT P.PNAME ,SPJ.QTY
FROM P,SPJ
WHERE P.PNO=SPJ.PNO
    AND SPJ.JNO='J2';

SELECT DISTINCT PNO
FROM SPJ,S
WHERE SPJ.`SNO`=S.`SNO`
    AND S.`CITY`='SHANGHAI';

SELECT JNAME
FROM J,SPJ,S
WHERE J.JNO=SPJ.JNO
    AND S.SNO=SPJ.SNO
    AND S.`CITY`='SHANGHAI';

SELECT DISTINCT JNO
FROM J
WHERE NOT EXISTS
    (
        SELECT *
        FROM SPJ,S
        WHERE  SPJ.JNO=J.JNO  --???
            AND SPJ.SNO=S.SNO
            AND S.CITY='TIANJIN'
    );

UPDATE P
SET `COLOR`='BLUE'
WHERE `COLOR`='RED';

UPDATE SPJ
SET SNO='S3'
WHERE SNO='S5'
    AND JNO='J4'
    AND PNO='P6';

DELETE 
FROM SPJ
WHERE SNO='S2';

DELETE 
FROM S
WHERE SNO='S2';